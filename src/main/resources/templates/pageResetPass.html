<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Weather Go</title>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <script th:src="@{/js/jquery.min.js}"></script>
    <script th:src="@{/js/bootstrap.min.js}"></script>
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/signup.css}">
</head>
<body>
<th:block th:replace="common/header :: header"></th:block>
<br>
<br>
<br>
<div class="container">
    <div class="row up-top" style="margin-top: 110px;">
        <div class="col-sm-9 col-md-7 col-lg-5 mx-auto">
            <div class="card my-5 boxsha-card-body">
                <div class="card-header bg-primary">
                    <h3 class="card-title text-center m-2 text-light" th:text="#{message.resetYourPassword}">Reset
                        Password</h3>
                </div>
                <div class="card-body">
                    <div class="mg-20" style="margin-top: 0px">
                        <form th:object="${resetPass}">
                            <span class="form-text text-center text-success" id="msgOK"></span>
                            <span class="form-text text-center text-danger" id="msg"></span>

                            <div class="form-group">
                                <label class="text-dark" th:text="#{login.fields.password}">password</label>
                                <input autofocus class="form-control" th:field="*{value}" id="password"
                                       required type="password" value=""/>
                            </div>

                            <div class="form-group">
                                <label class="text-dark" th:text="#{label.user.confirmPass}">confirm</label>
                                <input class="form-control" id="matchPassword" th:field="*{confirmValue}" required type="password" value=""/>

                                <span class="form-text text-danger" id="globalError" style="display:none"
                                      th:text="#{PasswordMatches.user}"
                                >error
                                </span>

                            </div>

                            <button class="btn btn-primary btn-block btn-forgot font-weight-bold" onclick="savePass()"
                                    th:text="#{message.resetYourPassword}"
                                    type="button">submit
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            <p class="form-text text-center text-muted bagde-custom" id="loginHide" style="margin-top: -30px"><a
                    th:href="@{/auth/login}">
                <u th:text="#{signup.info.login}"></u></a>
            </p>
        </div>
    </div>
</div>


<div class="snackbarError snackbarError2"
     id="snackbarError"
     th:text="#{snackMessageError}">Some text some
</div>

<th:block th:replace="common/footer :: footer"></th:block>

<script th:inline="javascript">
    /*<![CDATA[*/
    var serverContext = /*[[@{/}]]*/ '/';
    /*]]>*/
    $(document).ready(function () {
        $("#loginHide").hide();
        $("#matchPassword").keyup(function () {
            $('#msg').text("");
            $('#msgOK').text("");
            if ($("#matchPassword").val().length > 0) {
                if ($("#password").val() != $("#matchPassword").val()) {
                    $("#globalError").show().html(/*[[#{PasswordMatches.user}]]*/);
                } else {
                    $("#globalError").html("").hide();
                }
            } else {
                $("#globalError").html("").hide();
            }
        });
        $("#password").keyup(function () {
            $('#msg').text("");
            $('#msgOK').text("");
            if ($("#matchPassword").val().length > 0) {
                if ($("#password").val() != $("#matchPassword").val()) {
                    $("#globalError").show().html(/*[[#{PasswordMatches.user}]]*/);
                } else {
                    $("#globalError").html("").hide();
                }
            } else {
                $("#globalError").html("").hide();
            }
        });
    });
    function savePass(event) {
        $('#msg').text("");
        $('#msgOK').text("");
        if ($("#password").val() != $("#matchPassword").val()) {
            $("#globalError").show().html(/*[[#{PasswordMatches.user}]]*/);
            return;
        }
        var value = $("#password").val();
        var confirmValue = $("#matchPassword").val();
        $.ajax({
            type: 'PUT',
            url: '/api/accounts/save-password',
            contentType: 'application/json; charset=utf-8',
            cache: false,
            data: JSON.stringify({
                value: value,
                confirmValue: confirmValue
            }),
            success: function (data) {
                $('.card-body').waitMe('hide');
                $("#loginHide").show();
                $('#msgOK').text(data.message);
            },
            error: function (error) {
                $('#msg').text(error.responseJSON.message);
                $('.card-body').waitMe('hide');
                try {
                    (function ($) {
                        // Get the snackbar DIV
                        var x = document.querySelector("#snackbarError");
                        // Add the "show" class to DIV
                        x.className = "show";
                        // After 3 seconds, remove the show class from DIV
                        setInterval(function () {
                            x.className = x.className.replace("show", "");
                        }, 2900);
                    })(jQuery);
                } catch (err) {
                } finally {
                }
            }
        });
    }
</script>

</html>